# Telegram 提醒小助手机器人 🤖

一个智能的 Telegram 机器人，可以帮你设置各种时间提醒，支持自然语言输入、便捷的按钮操作、智能的连续提醒机制和完整的数据持久化。**所有关注机器人的用户都可以使用，无需特殊权限！**

## ✨ 功能特点

- 🕐 支持多种时间格式（今晚20点、明天上午9点、20:30等）
- 📝 自然语言输入，无需记忆复杂命令
- ⏰ 自动提醒，准时发送消息
- 🔘 便捷按钮操作（已完成、延后10分钟、删除提醒）
- 🔄 智能连续提醒，确保重要事项不被遗漏
- 💾 完整数据持久化，使用 SQLite + Sequelize
- 🔓 开放权限，所有关注用户都可以使用
- 📱 支持查看、删除提醒
- 📊 提醒历史和统计信息
- 🌍 支持时区设置

## 🚀 快速开始

### 1. 创建 Telegram 机器人

1. 在 Telegram 中搜索 `@BotFather`
2. 发送 `/newbot` 命令
3. 按提示设置机器人名称和用户名
4. 保存获得的 `BOT_TOKEN`

### 2. 安装依赖

```bash
npm install
```

### 3. 配置环境变量

复制 `env.example` 为 `.env` 并填写：

```bash
# 你的机器人 Token
BOT_TOKEN=1234567890:ABCdefGHIjklMNOpqrsTUVwxyz

# 时区设置
TIMEZONE=Asia/Shanghai
```

**注意：权限已开放，无需配置 ALLOWED_USERS！**

### 4. 初始化数据库

```bash
npm run init-db
```

### 5. 启动机器人

```bash
npm start
```

### 6. 开始使用

任何用户都可以：
1. 在 Telegram 中搜索你的机器人
2. 点击 "Start" 或发送 `/start`
3. 开始设置提醒！

## 📖 使用方法

### 基本命令

- `/start` - 开始使用机器人
- `/help` - 显示帮助信息
- `/reminders` - 查看你的提醒列表
- `/history` - 查看提醒历史记录
- `/stats` - 查看提醒统计信息

### 设置提醒

直接发送包含时间的消息即可：

```
今晚20点提现
明天上午9点开会
今天下午3点吃药
20:30 给客户打电话
20点30分 检查邮件
```

### 🔘 按钮操作

当收到提醒消息时，会显示三个操作按钮：

- **✅ 已完成** - 标记任务完成，提醒将被删除
- **⏰ 延后10分钟** - 将提醒时间延后10分钟，重新设置定时器
- **🗑️ 删除提醒** - 直接删除此提醒

### 删除提醒

发送 `删除 ID` 或 `删除 1` 来删除指定提醒。

## 🕐 支持的时间格式

| 输入格式 | 说明 | 示例 |
|---------|------|------|
| 今晚X点 | 今天18点后，明天18点前 | 今晚20点 |
| 明天上午X点 | 明天上午时间 | 明天上午9点 |
| 明天下午X点 | 明天下午时间 | 明天下午3点 |
| 明天晚上X点 | 明天晚上时间 | 明天晚上8点 |
| 今天上午X点 | 今天上午时间 | 今天上午10点 |
| 今天下午X点 | 今天下午时间 | 今天下午2点 |
| 今天晚上X点 | 今天晚上时间 | 今天晚上7点 |
| X:Y | 24小时制 | 20:30 |
| X点Y分 | 中文时间格式 | 20点30分 |

## 🔄 连续提醒机制

### 工作原理

机器人采用智能的连续提醒机制，确保重要事项不会因为用户忙碌而被遗忘：

1. **首次提醒** - 到达设定时间后发送第一次提醒
2. **等待期** - 首次提醒后等待 **5分钟**，给用户处理时间
3. **重复提醒** - 如果用户未操作，每 **10分钟** 重复发送提醒
4. **最大次数** - 最多重复 **5次**，防止过度打扰
5. **智能停止** - 任何按钮操作都会立即停止重复提醒

### 提醒时间表

| 提醒次数 | 时间间隔 | 说明 |
|---------|---------|------|
| 第1次 | 设定时间 | 初始提醒 |
| 第2次 | +5分钟 | 首次重复提醒 |
| 第3次 | +10分钟 | 第二次重复提醒 |
| 第4次 | +10分钟 | 第三次重复提醒 |
| 第5次 | +10分钟 | 第四次重复提醒 |
| 第6次 | +10分钟 | 最后一次提醒 |

### 停止重复提醒

以下操作会立即停止重复提醒：
- ✅ 点击"已完成"按钮
- ⏰ 点击"延后10分钟"按钮
- 🗑️ 点击"删除提醒"按钮
- 手动删除提醒

## 🔘 按钮操作详解

### 已完成按钮
- 点击后标记任务完成
- 提醒消息会更新为"✅ 提醒已完成！"
- 提醒从系统中删除，不再重复提醒
- **立即停止重复提醒**

### 延后10分钟按钮
- 将提醒时间延后10分钟
- 重新设置定时器
- 消息会更新显示新的提醒时间
- 按钮状态保持，可继续操作
- **重置重复提醒计数**

### 删除提醒按钮
- 直接删除提醒
- 消息更新为"🗑️ 提醒已删除！"
- 提醒从系统中完全移除
- **立即停止重复提醒**

## 💾 数据持久化

### 数据库架构

机器人使用 SQLite 数据库存储所有数据，包含以下表：

- **users** - 用户信息表
  - 存储用户 ID、用户名、姓名等基本信息
  - 支持用户信息的自动更新

- **reminders** - 提醒表
  - 存储所有待处理的提醒
  - 包含提醒时间、消息内容、状态、重复次数等

- **reminder_history** - 提醒历史表
  - 记录所有已完成的提醒
  - 包含完成时间、操作类型（完成/删除/过期）等

### 持久化特性

- **自动恢复** - 机器人重启后自动恢复所有待处理的提醒
- **数据安全** - 所有提醒数据永久保存，不会丢失
- **历史记录** - 完整的提醒操作历史，支持统计分析
- **状态同步** - 数据库状态与内存定时器完全同步

### 新增命令

- `/history` - 查看最近10条提醒历史
- `/stats` - 查看提醒统计信息（总数、完成数、完成率等）

## 🔓 权限说明

### 开放使用政策

- **无需权限配置** - 所有关注机器人的用户都可以使用
- **自动注册** - 执行 `/start` 命令后自动创建用户账户
- **数据隔离** - 每个用户只能看到和操作自己的提醒
- **安全可靠** - 用户数据完全隔离，互不干扰

### 使用流程

1. 用户在 Telegram 中搜索机器人
2. 点击 "Start" 或发送 `/start`
3. 机器人自动创建用户账户
4. 开始设置和使用提醒功能

## ⚙️ 配置说明

### 环境变量

- `BOT_TOKEN`: Telegram 机器人 Token（必需）
- `TIMEZONE`: 时区设置，默认 `Asia/Shanghai`

**注意：不再需要配置 ALLOWED_USERS！**

### 提醒配置

机器人内置的提醒配置（可在代码中调整）：

```javascript
const REMINDER_CONFIG = {
  initialDelay: 5 * 60 * 1000,      // 首次提醒后等待5分钟
  repeatInterval: 10 * 60 * 1000,    // 重复提醒间隔10分钟
  maxRepeats: 5                      // 最大重复次数
};
```

## 🔧 开发

### 安装开发依赖

```bash
npm install -D nodemon
```

### 开发模式运行

```bash
npm run dev
```

### 数据库操作

```bash
# 初始化数据库
npm run init-db

# 查看数据库文件
# 数据库文件位置: reminders.db
```

### 项目结构

```
├── src/
│   ├── bot.js              # 主要机器人逻辑
│   ├── models/
│   │   └── index.js        # 数据库模型定义
│   ├── services/
│   │   └── reminderService.js # 提醒服务类
│   └── init-db.js          # 数据库初始化脚本
├── package.json             # 项目依赖
├── env.example             # 环境变量示例
├── reminders.db            # SQLite 数据库文件
└── README.md               # 说明文档
```

## ⚠️ 注意事项

1. **安全性**: 不要将 `.env` 文件提交到版本控制系统
2. **权限**: 权限已开放，所有用户都可以使用，无需配置
3. **时区**: 确保 `TIMEZONE` 设置正确，避免提醒时间错误
4. **数据库**: 首次使用前必须运行 `npm run init-db` 初始化数据库
5. **按钮操作**: 延后操作会重新设置定时器，确保时间准确性
6. **连续提醒**: 连续提醒机制确保重要事项得到关注，但也会增加消息数量
7. **定时器管理**: 机器人会自动清理所有定时器，避免内存泄漏
8. **数据备份**: 定期备份 `reminders.db` 文件，防止数据丢失
9. **用户管理**: 用户数据自动管理，无需手动维护

## 🚀 部署建议

### 本地运行
适合个人使用和测试

### 服务器部署
- 使用 PM2 或 systemd 管理进程
- 设置开机自启动
- 配置日志轮转
- 监控内存使用情况
- 定期备份数据库文件

### 云服务部署
- Vercel、Railway、Heroku 等平台
- 注意免费平台可能有运行时间限制
- 考虑使用外部数据库服务（如 PostgreSQL）
- 配置自动备份策略

## 📝 许可证

MIT License

## 🤝 贡献

欢迎提交 Issue 和 Pull Request！

---

**提示**: 首次使用建议先在测试环境中验证功能，确保配置正确后再正式使用。权限开放让更多用户受益，数据持久化功能让提醒数据永远不会丢失！ 